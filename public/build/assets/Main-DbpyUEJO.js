import{P as ne,g as ee,r as M,c as b,o as u,a as r,t as w,n as te,J as re,K as ie,e as L,w as l,v as pe,u as e,bU as se,c3 as fe,M as de,X as ue,x as _,D as ce,E as H,Z as me,z as Q,b as t,a0 as ge,a1 as ve,a2 as we,a3 as ye,ad as Y,s as P,d as v,a5 as _e,a6 as xe,aC as ke,aG as he,aa as ae,aH as be}from"./app-Bjp7y-7M.js";import{i as Ue,j as $e,k as De,l as Ce,u as Ie,m as Pe,h as Se,n as Ee,_ as Ve,a as oe,b as z,c as Ne,d as Le,e as O,o as Me,f as Re,g as Ae}from"./pageSettings-D1DiSxYX.js";import{S as Be,F as Te,G as Fe,B as le,C as Ke}from"./shield-check-D88XaoGr.js";import{D as je}from"./download-CWJ7jdcO.js";import{S as ze}from"./settings-DDaDD1T9.js";import{S as Oe}from"./Spinner-BLxelPY2.js";/* empty css               */import"./useCopy-B4Y8MYr_.js";const Ge={class:"border-t pt-6"},We={class:"flex flex-col items-start w-full"},qe={class:"flex items-center gap-2 w-full"},He={class:"font-medium"},Je={class:"text-sm text-muted-foreground truncate max-w-full"},Xe={__name:"RelatedDocumentationNav",props:{header:{type:String,default:"Related Documentation"},docs:{type:Array,required:!0,validator:p=>p.every(h=>typeof h.title=="string"&&typeof h.description=="string"&&typeof h.link=="string"&&(!h.icon||typeof h.icon=="string"))},align:{type:String,default:"left",validator:p=>["left","center","right"].includes(p)}},setup(p){const h=ne(),S=p,U=x=>{x.startsWith("http://")||x.startsWith("https://")?window.open(x,"_blank","noopener,noreferrer"):h.push(x)},E=x=>({"external-link":se,book:le,git:Fe,code:fe,settings:ze,download:je,file:Te,security:Be})[x]||le,V=ee(()=>{switch(S.align){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}}),I=ee(()=>S.docs.length===1?"grid-cols-1":"grid-cols-1 md:grid-cols-2");return(x,f)=>{const c=M("Button");return u(),b("div",Ge,[r("h3",{class:te(["text-lg font-medium mb-4",V.value])},w(p.header),3),r("div",{class:te(["grid gap-4",I.value])},[(u(!0),b(re,null,ie(p.docs,(g,$)=>(u(),L(c,{key:$,variant:"outline",class:"justify-start h-auto p-4 bg-gradient-to-r from-rcgray-800 hover:from-rcgray-900 to-rcgray-900 border border-rcgray-700 rounded-lg transition-all duration-200 hover:border-rcgray-600",onClick:R=>U(g.link)},{default:l(()=>[r("div",We,[r("div",qe,[r("span",He,w(g.title),1),(u(),L(pe(g.link.startsWith("http")?e(se):E(g.icon)),{class:"h-3.5 w-3.5 text-muted-foreground ml-auto"}))]),r("span",Je,w(g.description),1)])]),_:2},1032,["onClick"]))),128))],2)])}}},Ze={class:"flex items-center"},Qe={class:"ml-2"},Ye={class:"grid items-center grid-cols-4 gap-2"},et={key:0},tt={class:"grid items-center grid-cols-4 gap-2"},st={key:0,class:"col-span-3 col-start-2 text-sm text-red-400"},at={class:"grid items-center grid-cols-4 gap-2"},ot={key:0,class:"col-span-3 col-start-2 text-sm text-red-400"},lt={class:"grid items-center grid-cols-4 gap-2"},nt={key:0,class:"text-red-400"},rt={key:0,class:"col-span-3 col-start-2 text-sm text-red-400"},it={class:"grid items-center grid-cols-4 gap-2"},dt={key:0,class:"text-red-400"},ut={key:0,class:"col-span-3 col-start-2 text-sm text-red-400"},ct={key:1,class:"col-span-3 col-start-2 text-sm text-green-400"},mt={class:"grid items-center grid-cols-4 gap-2 mt-2"},pt={class:"flex items-center col-span-3"},ft={class:"pl-2 ml-auto"},gt={class:"rc-kdb-class2"},vt={__name:"UserAddEditDialog",props:{editId:{type:Number,default:0}},emits:["save","close"],setup(p,{emit:h}){const{toastSuccess:S,toastError:U}=de(),E=ue(),{closeDialog:V,isDialogOpen:I}=E,x=h,f=p,c=_({}),g=_(!1),$=_(""),R=_(Date.now()),n=_({get_notifications:0,name:"",username:"",email:"",password:"",repeat_password:""});function B(y){y.ctrlKey&&y.key==="Enter"&&D()}function D(){g.value=!0;let y=f.editId>0?`/${f.editId}`:"",o=f.editId>0?"patch":"post";H[o]("/api/users"+y,n.value).then(d=>{g.value=!1,x("save",d.data),S(f.editId>0?"User updated":"User created",f.editId>0?"The user has been updated successfully.":"The user has been created successfully."),A(),V("DialogNewUser")}).catch(d=>{g.value=!1,c.value=d.response.data.errors,U("Error","There was an error saving the user. Please check the form for errors.")})}function T(){V("DialogNewUser"),f.editId===0&&A()}function A(){n.value={get_notifications:0,name:"",username:"",email:"",password:"",repeat_password:""},c.value={},R.value=Date.now()}return ce(()=>{f.editId>0&&H.get(`/api/users/${f.editId}`).then(y=>{n.value=y.data}).catch(y=>{var o,d,k,C;g.value=!1,c.value=((d=(o=y.response)==null?void 0:o.data)==null?void 0:d.errors)||{},U("Error",((C=(k=y.response)==null?void 0:k.data)==null?void 0:C.message)||"Failed to load user data")}),window.addEventListener("keydown",B)}),me(()=>{window.removeEventListener("keydown",B)}),Q(()=>[n.value.password,n.value.repeat_password],()=>{n.value.password&&n.value.repeat_password&&(n.value.password!==n.value.repeat_password?($.value="",c.value.repeat_password=["Passwords do not match"]):(delete c.value.repeat_password,$.value="Passwords match"))}),(y,o)=>{const d=M("RcIcon"),k=M("Label"),C=M("Input"),J=M("Switch"),N=M("Button");return u(),L(e(xe),{open:e(I)("DialogNewUser")},{default:l(()=>[t(e(ge),{"as-child":""}),t(e(ve),{class:"p-0 sm:max-w-fit",onEscapeKeyDown:T,onInteractOutside:T,onCloseAutoFocus:T},{default:l(()=>{var F,G,W,j,Z,a,X,i,m,K;return[t(e(we),{class:"rc-dialog-header"},{default:l(()=>[t(e(ye),{class:"text-sm text-rcgray-200"},{default:l(()=>[r("div",Ze,[t(d,{name:"user",class:"w-5 h-5"}),r("span",Qe,w(p.editId>0?"Edit":"Add")+" User "+w(p.editId>0?"(ID: "+p.editId+")":""),1)])]),_:1})]),_:1}),(u(),b("form",{key:R.value,autocomplete:"off",onSubmit:Y(D,["prevent"]),class:"grid gap-2 p-4",novalidate:""},[o[14]||(o[14]=r("input",{type:"text",style:{display:"none"},name:"fakeusernameremembered"},null,-1)),o[15]||(o[15]=r("input",{type:"password",style:{display:"none"},name:"fakepasswordremembered"},null,-1)),r("div",Ye,[t(k,{for:"name",class:"text-right"},{default:l(()=>[...o[8]||(o[8]=[v(" Name ",-1),r("span",{class:"text-red-400"},"*",-1)])]),_:1}),t(C,{modelValue:n.value.name,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value.name=s),id:"name",class:"col-span-3",autocomplete:"new-name",name:"new-name"},null,8,["modelValue"]),(G=(F=c.value)==null?void 0:F.name)!=null&&G[0]?(u(),b("span",et,w(c.value.name[0]),1)):P("",!0)]),r("div",tt,[t(k,{for:"username",class:"text-right"},{default:l(()=>[...o[9]||(o[9]=[v("Username",-1)])]),_:1}),t(C,{modelValue:n.value.username,"onUpdate:modelValue":o[1]||(o[1]=s=>n.value.username=s),id:"username",class:"col-span-3",autocomplete:"new-username",name:"new-username"},null,8,["modelValue"]),(j=(W=c.value)==null?void 0:W.username)!=null&&j[0]?(u(),b("span",st,w(c.value.username[0]),1)):P("",!0)]),r("div",at,[t(k,{for:"email-address",class:"text-right"},{default:l(()=>[...o[10]||(o[10]=[v(" Email ",-1),r("span",{class:"text-red-400"},"*",-1)])]),_:1}),t(C,{modelValue:n.value.email,"onUpdate:modelValue":o[2]||(o[2]=s=>n.value.email=s),id:"email-address",name:"email-address",type:"email",class:"col-span-3",autocomplete:"new-email"},null,8,["modelValue"]),(a=(Z=c.value)==null?void 0:Z.email)!=null&&a[0]?(u(),b("span",ot,w(c.value.email[0]),1)):P("",!0)]),r("div",lt,[t(k,{for:"new-password",class:"text-right"},{default:l(()=>[o[11]||(o[11]=v(" Password ",-1)),p.editId===0?(u(),b("span",nt,"*")):P("",!0)]),_:1}),t(C,{type:"password",modelValue:n.value.password,"onUpdate:modelValue":o[3]||(o[3]=s=>n.value.password=s),id:"new-password",name:"new-password",class:"col-span-3",autocomplete:"new-password"},null,8,["modelValue"]),(i=(X=c.value)==null?void 0:X.password)!=null&&i[0]?(u(),b("span",rt,w(c.value.password[0]),1)):P("",!0)]),r("div",it,[t(k,{for:"confirm-new-password",class:"text-right"},{default:l(()=>[o[12]||(o[12]=v(" Confirm Password ",-1)),p.editId===0?(u(),b("span",dt,"*")):P("",!0)]),_:1}),t(C,{type:"password",modelValue:n.value.repeat_password,"onUpdate:modelValue":o[4]||(o[4]=s=>n.value.repeat_password=s),id:"confirm-new-password",name:"confirm-new-password",class:"col-span-3",autocomplete:"new-password"},null,8,["modelValue"]),(K=(m=c.value)==null?void 0:m.repeat_password)!=null&&K[0]?(u(),b("span",ut,w(c.value.repeat_password[0]),1)):P("",!0),$.value&&n.value.password&&n.value.repeat_password?(u(),b("span",ct,w($.value),1)):P("",!0)]),r("div",mt,[t(k,{for:"get-notifications",class:"text-right"},{default:l(()=>[...o[13]||(o[13]=[v(" Notifications ",-1)])]),_:1}),r("div",pt,[t(J,{id:"get-notifications",modelValue:n.value.get_notifications,"onUpdate:modelValue":o[5]||(o[5]=s=>n.value.get_notifications=s),checked:n.value.get_notifications===1,"onUpdate:checked":o[6]||(o[6]=s=>n.value.get_notifications=s?1:0)},null,8,["modelValue","checked"]),t(k,{for:"get-notifications",class:"ml-2"},{default:l(()=>[v(w(n.value.get_notifications===1?"Enabled":"Disabled"),1)]),_:1})])])],32)),t(e(_e),{class:"rc-dialog-footer bg-rcgray-800"},{default:l(()=>[t(N,{type:"close",variant:"outline",class:"px-2 py-1 ml-2 text-sm hover:bg-gray-700 hover:animate-pulse",onClick:T,size:"sm"},{default:l(()=>[...o[16]||(o[16]=[v(" Cancel ",-1),r("div",{class:"pl-2 ml-auto"},[r("kbd",{class:"rc-kdb-class"},"ESC")],-1)])]),_:1}),t(N,{type:"submit",class:"px-2 py-1 ml-2 text-sm bg-blue-600 hover:bg-blue-700 hover:animate-pulse",size:"sm",onClick:o[7]||(o[7]=s=>D()),variant:"primary"},{default:l(()=>[t(Oe,{state:g.value,class:"mr-2"},null,8,["state"]),v(" "+w(f.editId>0?"Update":"Save")+" ",1),r("div",ft,[r("kbd",gt,[o[17]||(o[17]=v(" CtrlÂ  ",-1)),t(d,{name:"enter",class:"ml-1"})])])]),_:1})]),_:1})]}),_:1})]),_:1},8,["open"])}}};function wt(){const p=_(1),h=Ue(),S=_(h.get("useUsers","perPage",10)),U=_("-id"),E=_(""),V=_({}),I=ue(),x=_(0),f=_(!1),c=_(1),g=_(1),$=_([]),R=_(!1),{openDialog:n}=I,{toastSuccess:B,toastError:D}=de(),T=ne(),{reload:A}=De(d),{toggleSort:y}=$e(U,d,"useUsers"),o=_([]);async function d(i={}){f.value=!0;try{const m=await H.get("/api/users",{params:{page:p.value,perPage:S.value,sort:U.value,...V.value}});$.value=m.data,c.value=m.data.last_page}catch(m){console.error("Error fetching users:",m),D("Error","Failed to fetch users.")}finally{f.value=!1}}const k=i=>{x.value=0,g.value=Math.random(),n("DialogNewUser")};function C(i){x.value=i,g.value=Math.random(),n("DialogNewUser")}const J=async i=>{try{await H.delete(`/api/users/${i}`),d(),B("User Deleted","The user has been deleted successfully.")}catch(m){console.error("Error deleting user:",m),D("Error","Failed to delete user.")}},N=i=>{x.value=i,g.value=Math.random(),n("DialogNewUser")},F=()=>{d(),g.value=Math.random()};function G(i){i.altKey&&i.key==="n"&&(i.preventDefault(),n("DialogNewUser"))}const W=ke(()=>{V.value["filter[q]"]=E.value,p.value=1,d()},500);return Q(p,()=>{d()}),Q(E,()=>{W()}),Q(S,i=>{h.set("useUsers","perPage",i),d()}),{reload:A,users:$,isLoading:f,currentPage:p,perPage:S,lastPage:c,editId:x,newUserModalKey:g,searchTerm:E,openDialog:n,fetchUsers:d,navigateToActivityLog:()=>{T.push("/settings/users-activity-log")},createUser:k,updateUser:C,deleteUser:J,handleSave:F,handleKeyDown:G,viewEditDialog:N,toggleSort:y,sortParam:U,toggleNotification:async(i,m)=>{var K,s;try{await H.post(`/api/user/set-notification-status/${i}`,{status:m}),B("Notification settings updated","User notification preferences have been saved."),await d()}catch(q){D("Error updating notification settings",((s=(K=q.response)==null?void 0:K.data)==null?void 0:s.message)||"An unexpected error occurred")}},relatedDocs:o,showConfirmDelete:R,deleteManyUsers:async i=>{try{await H.post("/api/users/delete-many",{ids:i}),d(),B("Users Deleted","The users have been deleted successfully."),R.value=!1,Ce.emit("deleteManyUsersSuccess")}catch(m){m.status===422?D("Error",m.response.data.message):(console.error("Error deleting users:",m),D("Error","Failed to delete users.")),R.value=!1}},updateRelatedDocs:()=>{o.value=[{title:"User Management Guide",description:"Learn how to create, edit, and manage users in rConfig",link:"https://docs.rconfig.com/settings/users/",icon:"external-link"}]}}}const yt={class:"flex flex-col h-full gap-1 text-center"},_t={class:"flex items-center justify-between p-4"},xt={class:"flex items-center"},kt={class:"flex items-center justify-end"},ht={class:"px-6"},Et={__name:"Main",setup(p){const{reload:h,editId:S,users:U,currentPage:E,perPage:V,searchTerm:I,lastPage:x,isLoading:f,navigateToActivityLog:c,fetchUsers:g,viewEditDialog:$,createUser:R,deleteUser:n,handleSave:B,handleKeyDown:D,newUserModalKey:T,toggleSort:A,sortParam:y,toggleNotification:o,relatedDocs:d,showConfirmDelete:k,deleteManyUsers:C,updateRelatedDocs:J}=wt(),{selectedRows:N,selectAll:F,toggleSelectAll:G,toggleSelectRow:W}=Ie(U),j=he();return ce(()=>{g(),J(),window.addEventListener("keydown",D),j.params.userId&&parseInt(j.params.userId,10)>0&&$(j.params.userId)}),me(()=>{window.removeEventListener("keydown",D)}),(Z,a)=>{const X=M("Input"),i=M("Button"),m=M("RcIcon"),K=M("Checkbox");return u(),b("div",yt,[r("div",_t,[r("div",xt,[t(X,{class:"max-w-sm ml-4 mr-2",autocomplete:"off","data-1p-ignore":"","data-lpignore":"true",placeholder:"Filter users...",modelValue:e(I),"onUpdate:modelValue":a[0]||(a[0]=s=>ae(I)?I.value=s:null)},null,8,["modelValue"]),e(I)?(u(),L(Pe,{key:0,"onUpdate:modelValue":a[1]||(a[1]=s=>I.value="")})):P("",!0)]),r("div",kt,[e(N).length?(u(),L(i,{key:0,onClick:a[2]||(a[2]=Y(s=>k.value=!0,["prevent"])),class:"px-2 py-1 bg-red-600 hover:bg-red-700 hover:animate-pulse",size:"md",variant:"primary"},{default:l(()=>[v(" Delete Selected "+w(e(N).length)+" User(s) ",1)]),_:1})):P("",!0),t(i,{class:"px-2 py-1 ml-4 mr-2 text-sm hover:animate-pulse flex items-center",size:"sm",onClick:e(c),variant:"outline"},{default:l(()=>[t(e(Ke),{class:"h-4 w-4 mr-1"}),a[15]||(a[15]=v(" User Activity Log ",-1))]),_:1},8,["onClick"]),t(i,{type:"submit",class:"px-2 py-1 ml-2 text-sm bg-blue-600 hover:bg-blue-700 hover:animate-pulse",size:"sm",onClick:Y(e(R),["prevent"]),variant:"primary"},{default:l(()=>[...a[16]||(a[16]=[v(" New User ",-1),r("div",{class:"pl-2 ml-auto"},[r("kbd",{class:"rc-kdb-class2"},"ALT N")],-1)])]),_:1},8,["onClick"]),t(m,{name:"refresh",class:"w-4 h-4 mx-4 text-muted-foreground cursor-pointer hover:text-rcgray-200",onClick:a[3]||(a[3]=s=>e(h)())})])]),r("div",ht,[t(e(Ae),null,{default:l(()=>[t(e(Ve),null,{default:l(()=>[t(e(oe),null,{default:l(()=>[t(e(z),{class:"w-[2%]"},{default:l(()=>[t(K,{id:"selectAll",modelValue:e(F),"onUpdate:modelValue":a[4]||(a[4]=s=>ae(F)?F.value=s:null),onClick:a[5]||(a[5]=s=>e(G)())},null,8,["modelValue"])]),_:1}),t(e(z),{class:"w-[5%]"},{default:l(()=>[t(i,{class:"flex justify-start w-full p-0 hover:bg-rcgray-800",variant:"ghost",onClick:a[6]||(a[6]=s=>e(A)("id"))},{default:l(()=>[t(m,{name:"sort",sortParam:e(y),field:"id"},null,8,["sortParam"]),a[17]||(a[17]=r("span",{class:"ml-2"},"ID",-1))]),_:1})]),_:1}),t(e(z),{class:"w-[20%]"},{default:l(()=>[t(i,{class:"flex justify-start w-full p-0 hover:bg-rcgray-800",variant:"ghost",onClick:a[7]||(a[7]=s=>e(A)("name"))},{default:l(()=>[t(m,{name:"sort",sortParam:e(y),field:"name"},null,8,["sortParam"]),a[18]||(a[18]=r("span",{class:"ml-2"},"Name",-1))]),_:1})]),_:1}),t(e(z),{class:"w-[25%]"},{default:l(()=>[t(i,{class:"flex justify-start w-full p-0 hover:bg-rcgray-800",variant:"ghost",onClick:a[8]||(a[8]=s=>e(A)("email"))},{default:l(()=>[t(m,{name:"sort",sortParam:e(y),field:"email"},null,8,["sortParam"]),a[19]||(a[19]=r("span",{class:"ml-2"},"Email",-1))]),_:1})]),_:1}),t(e(z),null,{default:l(()=>[...a[20]||(a[20]=[v("Notifications",-1)])]),_:1}),t(e(z),{class:"w-[20%]"},{default:l(()=>[t(i,{class:"flex justify-start w-full p-0 hover:bg-rcgray-800",variant:"ghost",onClick:a[9]||(a[9]=s=>e(A)("last_login"))},{default:l(()=>[t(m,{name:"sort",sortParam:e(y),field:"last_login"},null,8,["sortParam"]),a[21]||(a[21]=r("span",{class:"ml-2"},"Last Login",-1))]),_:1})]),_:1}),t(e(z),{class:"w-[10%]"},{default:l(()=>[...a[22]||(a[22]=[v("Actions",-1)])]),_:1})]),_:1})]),_:1}),t(e(Ne),null,{default:l(()=>[e(f)?(u(),L(Le,{key:0})):e(f)?(u(),L(Re,{key:2})):(u(!0),b(re,{key:1},ie(e(U).data,s=>(u(),L(e(oe),{key:s.id},{default:l(()=>[t(e(O),{class:"text-start"},{default:l(()=>[t(K,{class:"cursor-pointer",id:"select-"+s.id,checked:!!e(N).includes(s.id),onClick:q=>e(W)(s.id)},null,8,["id","checked","onClick"])]),_:2},1024),t(e(O),{class:"text-start"},{default:l(()=>[v(w(s.id),1)]),_:2},1024),t(e(O),{class:"text-start"},{default:l(()=>[v(w(s.name),1)]),_:2},1024),t(e(O),{class:"text-start"},{default:l(()=>[v(w(s.email),1)]),_:2},1024),t(e(O),{class:"text-start"},{default:l(()=>[t(e(be),{id:`notif-${s.id}`,checked:s.get_notifications===1,"onUpdate:checked":q=>e(o)(s.id,q?1:0)},null,8,["id","checked","onUpdate:checked"])]),_:2},1024),t(e(O),{class:"text-start"},{default:l(()=>[v(w(s.last_login),1)]),_:2},1024),t(e(O),{class:"text-start"},{default:l(()=>[t(Me,{rowData:s,onOnEdit:q=>e($)(s.id),onOnDelete:q=>e(n)(s.id)},null,8,["rowData","onOnEdit","onOnDelete"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(Se,{currentPage:e(E),lastPage:e(x),perPage:e(V),"onUpdate:currentPage":a[10]||(a[10]=s=>E.value=s),"onUpdate:perPage":a[11]||(a[11]=s=>V.value=s),totalRecords:e(U).total,isLoading:e(f)},null,8,["currentPage","lastPage","perPage","totalRecords","isLoading"]),(u(),L(vt,{onSave:a[12]||(a[12]=s=>e(B)()),key:e(T),editId:e(S)},null,8,["editId"])),t(Ee,{ids:e(N),showConfirmDelete:e(k),onClose:a[13]||(a[13]=s=>k.value=!1),onHandleDelete:a[14]||(a[14]=s=>e(C)(e(N)))},null,8,["ids","showConfirmDelete"]),e(d).length>0?(u(),L(Xe,{key:0,docs:e(d)},null,8,["docs"])):P("",!0)])])}}};export{Et as default};
