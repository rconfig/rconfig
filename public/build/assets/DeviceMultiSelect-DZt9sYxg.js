import{x as m,g as j,z as O,a9 as P,D as W,r as b,e as q,o as s,w as h,b as i,u as r,V as X,n as Z,c,s as V,J as D,K as E,a as d,t as y,ab as G,W as Q,R as Y,d as ee,U as te,E as se,aZ as ae}from"./app-BdO4bxZX.js";import{u as le}from"./useMultiSelect-lY6OIy6j.js";import{X as oe}from"./x-pA3Jju4p.js";const ne={key:0,class:"flex-1 text-left mr-2"},re={key:1,class:"flex flex-wrap gap-1 flex-1 overflow-hidden"},ce={class:"flex items-center text-xs font-medium px-2.5 py-0.5 rounded-xl border whitespace-nowrap max-w-[150px]"},ie={class:"truncate"},ue={key:0,class:"flex items-center text-xs font-medium px-2.5 py-0.5 rounded-xl border bg-muted text-muted-foreground flex-shrink-0"},de={class:"relative items-center w-full"},ve={class:"absolute inset-y-0 flex items-center justify-center px-2 start-0"},me={class:"py-1"},fe=["onClick"],pe={class:"cursor-default text-xs font-medium me-2 px-2.5 py-0.5 rounded-xl border"},_e={key:0,class:"text-center rc-text-xs-muted"},he={key:1,class:"flex justify-center py-2"},xe={key:2,class:"text-center py-2 rc-text-xs-muted"},ge={key:3,class:"text-center py-4 rc-text-xs-muted"},Se={__name:"DeviceMultiSelect",props:{modelValue:{type:[Array,Object],required:!0},singleSelect:{type:Boolean,default:!1},placeholder:{type:String,default:"Select devices"}},emits:["update:modelValue"],setup(F,{emit:z}){const R=z,l=m([]),C=m(!1),p=m(!1),x=m(!0),w=m(1),L=m(0),u=m(""),_=m(null),B=F,{selectedItems:f,selectItem:A,deleteItem:H}=le({items:l,modelValue:B.modelValue,singleSelect:B.singleSelect,displayField:"device_name",searchFields:["device_name"],emit:R}),T=j(()=>{if(!u.value)return l.value;const e=u.value.toLowerCase();return l.value.filter(t=>t.device_name.toLowerCase().includes(e))}),M=j(()=>u.value?T.value:l.value);function U(e){const t=f.value.find(a=>a.device_name===e);t&&H(t.id)}const $=P(async e=>{e.length>0?await g(1,e,!0):J()},300);O(u,e=>{(e.length>=2||e.length===0)&&$(e)});async function g(e=1,t="",a=!1){e===1?C.value=!0:p.value=!0;try{const o={page:e,per_page:50,sort:"device_name"};t&&(o["filter[device_name]"]=t);const v=await se.get("/api/get-devices-filter-list",{params:o}),k=v.data.data;if(a||e===1)l.value=k;else{const n=new Set(l.value.map(S=>S.id)),I=k.filter(S=>!n.has(S.id));l.value=[...l.value,...I]}w.value=v.data.current_page,x.value=v.data.current_page<v.data.last_page,L.value=v.data.total}catch(o){console.error("Error fetching devices:",o)}finally{C.value=!1,p.value=!1}}function J(){l.value=[],w.value=1,x.value=!0,g(1)}async function N(e){if(u.value||p.value||!x.value)return;const{scrollTop:t,scrollHeight:a,clientHeight:o}=e.target;t+o>=a-100&&await g(w.value+1)}function K(){ae(()=>{var t,a,o;const e=((t=_.value)==null?void 0:t.querySelector("[data-radix-scroll-area-viewport]"))||((a=_.value)==null?void 0:a.querySelector(".scroll-area-viewport"))||((o=_.value)==null?void 0:o.querySelector("[data-scroll-area-viewport]"));e?e.addEventListener("scroll",N):_.value&&_.value.addEventListener("scroll",N)})}return W(()=>{g(1),K()}),(e,t)=>{const a=b("RcIcon"),o=b("Button"),v=b("Input"),k=b("Separator");return s(),q(r(te),null,{default:h(()=>[i(r(X),{class:"flex items-center"},{default:h(()=>[i(o,{variant:"ghost",class:Z(["flex items-center justify-start p-1 pl-2 border h-fit gap-1 min-w-2xl",r(f).length===0?"text-muted-foreground":""])},{default:h(()=>[i(a,{name:"device",class:"flex-shrink-0 mx-2"}),r(f)&&r(f).length===0?(s(),c("span",ne," Select devices ")):(s(),c("div",re,[(s(!0),c(D,null,E(r(f).slice(0,3),(n,I)=>(s(),c("span",{key:n.id,class:"relative group flex-shrink-0"},[d("span",ce,[d("span",ie,y(n.device_name),1),i(r(oe),{size:"10",class:"ml-1 cursor-pointer text-rcgray-300 hover:text-white flex-shrink-0",onClick:G(S=>U(n.device_name),["stop"])},null,8,["onClick"])])]))),128)),r(f).length>3?(s(),c("span",ue," +"+y(r(f).length-3)+" more ",1)):V("",!0)]))]),_:1},8,["class"])]),_:1}),i(r(Q),{side:"bottom",align:"start",class:"col-span-3 p-0"},{default:h(()=>[d("div",de,[i(v,{id:"search",type:"text",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),autocomplete:"off",placeholder:"Search...",class:"pl-10 border-none focus:outline-none focus-visible:ring-0 text-muted-foreground font-inter"},null,8,["modelValue"]),d("span",ve,[i(a,{name:"search"})])]),i(k),i(r(Y),{ref_key:"scrollContainer",ref:_,class:"h-64"},{default:h(()=>[d("div",me,[C.value?(s(),q(a,{key:0,name:"three-dots-loading",class:"w-8 h-8 mx-auto my-4 text-muted-foreground"})):(s(),c(D,{key:1},[(s(!0),c(D,null,E(M.value,n=>(s(),c("div",{key:n.id,class:"w-full p-1 pl-2 my-1 text-xs rounded-lg hover:bg-rcgray-600 cursor-pointer",onClick:I=>r(A)(n)},[d("span",pe,y(n.device_name),1)],8,fe))),128)),x.value&&!u.value?(s(),c("div",_e,[i(o,{onClick:t[1]||(t[1]=n=>g(w.value+1)),disabled:p.value,variant:"outline",class:"load-more-btn my-4"},{default:h(()=>[t[2]||(t[2]=d("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"},[d("path",{d:"M12 8v8m0 0l4-4m-4 4l-4-4"}),d("path",{d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"})],-1)),ee(" "+y(p.value?"Loading...":`Load More (${l.value.length}/${L.value})`),1)]),_:1},8,["disabled"])])):V("",!0),p.value?(s(),c("div",he,[i(a,{name:"three-dots-loading",class:"w-6 h-6 text-muted-foreground"})])):!x.value&&!u.value&&l.value.length>0?(s(),c("div",xe,"No more devices to load ("+y(l.value.length)+" total)",1)):u.value&&M.value.length===0?(s(),c("div",ge," No devices found ")):V("",!0)],64))])]),_:1},512)]),_:1})]),_:1})}}};export{Se as _};
